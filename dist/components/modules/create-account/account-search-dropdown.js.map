{"version":3,"file":"account-search-dropdown.js","sourceRoot":"","sources":["../../../../src/components/modules/create-account/account-search-dropdown.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { cn } from \"@/utils\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverAnchor,\n} from \"@/components/primitives/popover\";\nimport {\n  useAccountSearch,\n  AccountSearchResult,\n} from \"@/utils/hooks/useAccountSearch\";\nimport { AccountSearchResultItem } from \"./account-search-result\";\n\nexport interface AccountSearchDropdownProps {\n  query: string;\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSelect: (result: AccountSearchResult) => void;\n  children: React.ReactNode;\n  selectedIndex?: number;\n  onSelectedIndexChange?: (index: number | undefined) => void;\n  // Optional mock data for Storybook\n  mockResults?: AccountSearchResult[];\n  mockIsLoading?: boolean;\n  mockError?: Error;\n}\n\nexport const AccountSearchDropdown = React.forwardRef<\n  HTMLDivElement,\n  AccountSearchDropdownProps\n>(\n  (\n    {\n      query,\n      isOpen,\n      onOpenChange,\n      onSelect,\n      children,\n      selectedIndex,\n      onSelectedIndexChange,\n      mockResults,\n      mockIsLoading,\n      mockError,\n    },\n    ref,\n  ) => {\n    // Use mock data if provided, otherwise use real hook\n    const hookData =\n      mockResults !== undefined\n        ? { results: [], isLoading: false, error: undefined }\n        : useAccountSearch(query, {\n            minLength: 1,\n            debounceMs: 300,\n            maxResults: 5,\n          });\n\n    const results = mockResults ?? hookData.results;\n    const isLoading = mockIsLoading ?? hookData.isLoading;\n    const error = mockError ?? hookData.error;\n\n    const hasResults = results.length > 0;\n    const shouldShowDropdown = React.useMemo(() => {\n      return Boolean(isOpen && query.length > 0 && (hasResults || isLoading));\n    }, [isOpen, hasResults, isLoading, query.length]);\n\n    const handleSelect = React.useCallback(\n      (result: AccountSearchResult) => {\n        onSelect(result);\n        onOpenChange(false);\n        onSelectedIndexChange?.(undefined);\n      },\n      [onSelect, onOpenChange, onSelectedIndexChange],\n    );\n\n    // Handle keyboard navigation\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent) => {\n        if (!shouldShowDropdown) return;\n\n        switch (event.key) {\n          case \"ArrowDown\": {\n            event.preventDefault();\n            const nextIndex =\n              selectedIndex === undefined\n                ? 0\n                : Math.min(selectedIndex + 1, results.length - 1);\n            onSelectedIndexChange?.(nextIndex);\n            break;\n          }\n\n          case \"ArrowUp\": {\n            event.preventDefault();\n            const prevIndex =\n              selectedIndex === undefined\n                ? results.length - 1\n                : Math.max(selectedIndex - 1, 0);\n            onSelectedIndexChange?.(prevIndex);\n            break;\n          }\n\n          case \"Enter\": {\n            event.preventDefault();\n            if (selectedIndex !== undefined && results[selectedIndex]) {\n              handleSelect(results[selectedIndex]);\n            }\n            break;\n          }\n\n          case \"Escape\": {\n            event.preventDefault();\n            onOpenChange(false);\n            onSelectedIndexChange?.(undefined);\n            break;\n          }\n        }\n      },\n      [\n        shouldShowDropdown,\n        selectedIndex,\n        results,\n        onSelectedIndexChange,\n        onOpenChange,\n        handleSelect,\n      ],\n    );\n\n    // Attach keyboard event listener to the trigger element\n    React.useEffect(() => {\n      const handleGlobalKeyDown = (event: KeyboardEvent) => {\n        handleKeyDown(event as unknown as React.KeyboardEvent);\n      };\n\n      if (shouldShowDropdown) {\n        document.addEventListener(\"keydown\", handleGlobalKeyDown);\n        return () => {\n          document.removeEventListener(\"keydown\", handleGlobalKeyDown);\n        };\n      }\n    }, [shouldShowDropdown, handleKeyDown]);\n\n    return (\n      <Popover open={isOpen} onOpenChange={onOpenChange}>\n        <PopoverAnchor ref={ref}>{children}</PopoverAnchor>\n        {shouldShowDropdown && (\n          <PopoverContent\n            className={cn(\n              \"w-[--radix-popover-trigger-width] p-0 bg-spacer border-none -translate-y-7 divide-y divide-spacer\",\n              \"max-h-[300px] overflow-y-auto\",\n            )}\n            align=\"start\"\n            sideOffset={4}\n            onOpenAutoFocus={(e) => e.preventDefault()}\n            onCloseAutoFocus={(e) => e.preventDefault()}\n          >\n            {isLoading && (\n              <div className=\"px-3 py-2.5 text-sm text-foreground-400\">\n                Searching...\n              </div>\n            )}\n\n            {error && (\n              <div className=\"px-3 py-2.5 text-sm text-destructive-100\">\n                Failed to search accounts\n              </div>\n            )}\n\n            {!isLoading &&\n              !error &&\n              results.length === 0 &&\n              query.length > 0 && (\n                <div className=\"px-3 py-2.5 text-sm text-foreground-400\">\n                  No accounts found\n                </div>\n              )}\n\n            {!isLoading &&\n              !error &&\n              results.map((result, index) => (\n                <AccountSearchResultItem\n                  key={result.id}\n                  result={result}\n                  isSelected={selectedIndex === index}\n                  onClick={() => handleSelect(result)}\n                  onMouseEnter={() => onSelectedIndexChange?.(index)}\n                  onMouseLeave={() => onSelectedIndexChange?.(undefined)}\n                />\n              ))}\n          </PopoverContent>\n        )}\n      </Popover>\n    );\n  },\n);\n\nAccountSearchDropdown.displayName = \"AccountSearchDropdown\";\n\nexport default AccountSearchDropdown;\n"]}