{"version":3,"file":"preview.js","sourceRoot":"","sources":["../../../../../src/components/modules/collectibles/preview/preview.tsx"],"names":[],"mappings":"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","sourcesContent":["import { PLACEHOLDER } from \"@/assets\";\nimport { CollectibleTag, StackDiamondIcon, TagIcon } from \"@/index\";\nimport { cn, formatNumber } from \"@/utils\";\nimport { cva, VariantProps } from \"class-variance-authority\";\nimport { useEffect, useState } from \"react\";\n\nexport interface CollectiblePreviewProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof collectiblePreviewVariants> {\n  images: string[];\n  totalCount?: number;\n  listingCount?: number;\n}\n\nconst collectiblePreviewVariants = cva(\n  \"relative flex items-center justify-center overflow-hidden shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"\",\n      },\n      size: {\n        sm: \"p-2 h-[128px]\",\n        md: \"p-2 h-[128px]\",\n        lg: \"p-2 h-[200px] rounded-lg\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"md\",\n    },\n  },\n);\n\nexport const CollectiblePreview = ({\n  images,\n  totalCount,\n  listingCount,\n  variant,\n  size,\n  className,\n  onError,\n  ...props\n}: CollectiblePreviewProps) => {\n  const [currentSrcIndex, setCurrentSrcIndex] = useState(0);\n  const [data, setData] = useState<string | null>(null);\n\n  const currentSrc =\n    images && images.length > 0 ? images[currentSrcIndex] : PLACEHOLDER;\n\n  useEffect(() => {\n    const fetchData = async () => {\n      if (!currentSrc) return;\n\n      try {\n        const res = await fetch(currentSrc);\n        if (!res.ok) return;\n\n        const text = await res.text();\n        if (!text.includes('width=\"100width=\"100%\"')) return;\n\n        const match = text.match(/data:image\\/png;base64,[^)\"]+/);\n        if (match && match.length > 0) setData(match[0]);\n      } catch (error) {\n        console.error(\"Error fetching image:\", error);\n      }\n    };\n    fetchData();\n  }, [currentSrc]);\n\n  const handleImageError = (\n    e: React.SyntheticEvent<HTMLImageElement, Event>,\n  ) => {\n    if (currentSrcIndex < images.length - 1 && !!images[currentSrcIndex + 1]) {\n      setCurrentSrcIndex(currentSrcIndex + 1);\n    } else {\n      e.currentTarget.src = PLACEHOLDER;\n      if (onError) onError(e);\n    }\n  };\n\n  return (\n    <div\n      className={cn(collectiblePreviewVariants({ variant, size }), className)}\n      {...props}\n    >\n      <div className=\"absolute grow inset-0 blur-[8px] transition-opacity duration-150 opacity-75 group-hover:opacity-100\">\n        <img\n          src={data || currentSrc}\n          className=\"object-cover absolute inset-0 w-full h-full image-pixelated\"\n          onError={handleImageError}\n        />\n        <div\n          className=\"bg-center bg-cover h-full w-full relative\"\n          style={{\n            backgroundImage: `linear-gradient(0deg, rgba(0, 0, 0, 0.64), rgba(0, 0, 0, 0.64))`,\n          }}\n        />\n      </div>\n      <img\n        className=\"object-contain h-full w-full relative transition duration-150 ease-in-out group-hover:scale-[1.02]\"\n        style={{ imageRendering: \"pixelated\" }}\n        draggable={false}\n        src={data || currentSrc}\n        onError={handleImageError}\n      />\n      <div className=\"flex gap-1 items-center flex-wrap justify-start absolute bottom-1.5 left-1.5\">\n        {!!totalCount && (\n          <CollectibleTag label={`${formatNumber(totalCount)}`}>\n            <StackDiamondIcon variant=\"solid\" size=\"sm\" />\n          </CollectibleTag>\n        )}\n        {!!listingCount && (\n          <CollectibleTag label={`${formatNumber(listingCount)}`}>\n            <TagIcon variant=\"solid\" size=\"sm\" />\n          </CollectibleTag>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CollectiblePreview;\n"]}